#!/usr/bin/env just
# -*- mode: just -*-

# Justfile for system-level maintenance tasks
import '~/.justfile_common'

# * Default
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
default:
    @just --list

# * Scoop
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Scoop

# ğŸ” Check for outdated Scoop packages
scoop-check:
    @echo "ğŸ”„ Updating Scoop buckets (for accurate status)..."
    scoop update
    @echo
    @echo "ğŸ” Checking for outdated Scoop apps..."
    scoop status

# ğŸ“¦ Upgrade all Scoop buckets and apps
scoop-upgrade:
    @echo "ğŸ“¦ Updating Scoop buckets..."
    scoop update
    @echo "ğŸ“¦ Upgrading installed Scoop apps..."
    scoop update --all

# â™»ï¸ Reset all Scoop-installed applications (e.g. to fix broken icons)
scoop-reset:
    @echo "â™»ï¸ Resetting all Scoop apps to repair shortcuts/icons..."
    scoop reset --all

# ğŸ§¹ Cleanup unused Scoop app versions
scoop-clean:
    @echo "ğŸ§¹ Cleaning up unused Scoop versions..."
    scoop cleanup --all

# TODO: registry updates... where should these go long term?
scoop-register:
    reg import "C:\Users\lambert.green\scoop\apps\wezterm\current\install-context.reg"

# * Chocolatey
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Choco

# ğŸ” Show outdated Chocolatey packages
choco-check:
    @echo "ğŸ” Checking for outdated Chocolatey packages..."
    choco outdated

# ğŸ“¦ Upgrade all Chocolatey packages
choco-upgrade:
    @echo "ğŸ“¦ Upgrading all Chocolatey packages..."
    sudo choco upgrade all -y

# * Winget
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Winget

# ğŸ” Winget upgrades available
winget-check:
    @echo "ğŸ” Checking for Winget package updates..."
    winget upgrade --include-unknown

# ğŸ“¦ Upgrade Winget packages (interactive or scripted)
winget-upgrade:
    @echo "ğŸ“¦ Upgrading Winget packages..."
    winget upgrade --all --include-unknown --accept-source-agreements --accept-package-agreements

# * Msys2
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Msys2

# ğŸ” Preview available MSYS2 upgrades
msys2-check:
    @echo "ğŸ” Checking for MSYS2 package updates..."
    @/usr/bin/bash.exe -lc 'yes n | pacman -Syu || true'

# â™»ï¸ Upgrade MSYS2 packages (auto-confirm)
msys2-upgrade:
    @echo "â™»ï¸ Upgrading MSYS2 packages..."
    @/usr/bin/bash.exe -lc 'pacman -Syu --noconfirm'

# ğŸ§¹ Clean up MSYS2 package cache and old versions
msys2-clean:
    @echo "ğŸ§¹ Cleaning MSYS2 cache and stale packages..."
    @/usr/bin/bash.exe -lc 'pacman -Sc --noconfirm && paccache -rv'

# * OS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category OS

# ğŸ§­ Check for pending Windows OS updates (requires PSWindowsUpdate)
os-check:
    @echo "ğŸ§­ Checking for pending Windows updates (PowerShell)..."
    @sudo powershell -Command "Get-WindowsUpdate"

# * System
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category System

# ğŸ” Preview system package updates (no changes applied)
system-check: scoop-check choco-check winget-check msys2-check os-check

# ğŸ“¦ Apply weekly system upgrades (safe, routine updates)
system-upgrade: scoop-upgrade choco-upgrade winget-upgrade

# ğŸ§¹ Monthly system maintenance (includes upgrade + cleanup + shortcut fix)
system-maintain: system-upgrade msys2-upgrade scoop-clean scoop-reset
