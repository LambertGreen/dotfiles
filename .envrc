# Python virtual environment setup
if [ ! -d .venv ]; then
    echo "🐍 Creating Python virtual environment..."
    python3 -m venv .venv
fi

# Activate virtual environment
source .venv/bin/activate
export VIRTUAL_ENV="$(pwd)/.venv"

# Install/update requirements if needed
if [ ! -f .venv/.requirements-installed ] || [ requirements.txt -nt .venv/.requirements-installed ]; then
    echo "📦 Installing Python requirements..."
    pip install -r requirements.txt
    touch .venv/.requirements-installed
fi

# Install pre-commit hooks if available
if command -v pre-commit >/dev/null 2>&1; then
    if [ ! -f .git/hooks/pre-commit ] || ! grep -q "pre-commit" .git/hooks/pre-commit; then
        echo "📋 Installing pre-commit hooks..."
        pre-commit install
    fi
fi

# Load local environment variables (secrets)
if [ -f .envrc.local ]; then
    echo "🔐 Loading local environment variables..."
    source .envrc.local
fi
