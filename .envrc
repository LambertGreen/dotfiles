# Use direnv layout for proper Python version control
layout pyenv 3.9.18

# Install/update requirements if needed
if [ ! -f $VIRTUAL_ENV/.requirements-installed ] || [ requirements.txt -nt $VIRTUAL_ENV/.requirements-installed ]; then
    echo "📦 Installing Python requirements..."
    pip install -r requirements.txt
    touch $VIRTUAL_ENV/.requirements-installed
fi

# Install pre-commit hooks if available
if command -v pre-commit >/dev/null 2>&1; then
    if [ ! -f .git/hooks/pre-commit ] || ! grep -q "pre-commit" .git/hooks/pre-commit; then
        echo "📋 Installing pre-commit hooks..."
        pre-commit install
    fi
fi

# Load local environment variables (secrets)
if [ -f .envrc.local ]; then
    echo "🔐 Loading local environment variables..."
    source .envrc.local
fi
