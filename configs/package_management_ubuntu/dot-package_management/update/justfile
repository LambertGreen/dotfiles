#!/usr/bin/env just
# -*- mode: just -*-

# Justfile for Linux system-level maintenance tasks
# This file assumes the use of APT (e.g. Ubuntu, Debian)
# Other distros should use their respective package manager

import 'justfile_common'
import 'justfile_posix'
import 'justfile_dev_common'

# * Default
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
default:
    @just --list

# * APT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Apt

# ðŸ”Ž Check for APT package updates
apt-check:
    @echo "ðŸ”Ž Checking for APT updates..."
    sudo apt update --quiet

# ðŸ“¦ Upgrade APT packages
apt-upgrade:
    @echo "ðŸ“¦ Upgrading APT packages..."
    sudo apt upgrade -y

# ðŸ›‚ Clean up APT cache and obsolete packages
apt-clean:
    @echo "ðŸ›‚ Cleaning APT cache..."
    sudo apt autoremove -y
    sudo apt clean

# * System
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category System

# ðŸ”Ž Preview system updates
system-check: brew-check apt-check

# ðŸ› ï¸ Fast weekly update
system-upgrade: apt-upgrade brew-upgrade completions-upgrade

# ðŸ§¹ Clean system caches (APT & Homebrew)
system-clean: apt-clean brew-clean

# ðŸ§¹ðŸ› ï¸ Monthly deep maintenance (composed of upgrade + clean)
system-maintain: system-upgrade system-clean zinit-upgrade emacs-upgrade

# =============================================================================
# LEVEL-BASED UPDATE RECIPES (matches bootstrap levels - which package managers are available)
# =============================================================================

# Basic level - system package manager only (matches bootstrap-basic)
update-basic: apt-upgrade
    @echo "âœ… Basic Ubuntu updates complete (apt packages only)!"

# Typical level - system + Homebrew (matches bootstrap-typical)
update-typical: apt-upgrade brew-upgrade
    @echo "âœ… Typical Ubuntu updates complete (apt + homebrew packages)!"

# Max level - all package managers including Nix (matches bootstrap-max)
update-max: apt-upgrade brew-upgrade
    @echo "ðŸ”„ Updating Nix packages..."
    @if command -v nix >/dev/null 2>&1; then \
        nix-channel --update && nix-env -u; \
        echo "âœ… Max Ubuntu updates complete (apt + homebrew + Nix)!"; \
    else \
        echo "âœ… Max Ubuntu updates complete (apt + homebrew, Nix not installed)!"; \
    fi
