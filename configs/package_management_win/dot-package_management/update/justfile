#!/usr/bin/env just
# -*- mode: just -*-

# Justfile for **Windows** systemâ€‘level maintenance tasks
import 'justfile_common'
import 'justfile_dev_common'

# * Default
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category General

default:
    @just --list

# * Scoop
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Scoop

# ğŸ” Check for outdated Scoop packages
scoop-check:
    @echo "ğŸ”„ Updating Scoop buckets (for accurate status)â€¦"
    scoop update
    @echo
    @echo "ğŸ” Checking for outdated Scoop appsâ€¦"
    scoop status

# ğŸ“¦ Upgrade all Scoop buckets and apps
scoop-upgrade:
    @echo "ğŸ“¦ Updating Scoop bucketsâ€¦"
    scoop update
    @echo "ğŸ“¦ Upgrading installed Scoop appsâ€¦"
    scoop update --all

# â™»ï¸ Reset all Scoopâ€‘installed applications (e.g. to fix broken icons)
scoop-reset:
    @echo "â™»ï¸ Resetting all Scoop apps to repair shortcuts/iconsâ€¦"
    scoop reset --all

# ğŸ§¹ Cleanup unused Scoop app versions
scoop-clean:
    @echo "ğŸ§¹ Cleaning up unused Scoop versionsâ€¦"
    scoop cleanup --all

# Registry tweaks (temporary)
scoop-register:
    reg import "C:\\Users\\lambert.green\\scoop\\apps\\wezterm\\current\\install-context.reg"

# * Chocolatey
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Choco

# ğŸ” Show outdated Chocolatey packages
choco-check:
    @echo "ğŸ” Checking for outdated Chocolatey packagesâ€¦"
    choco outdated

# ğŸ“¦ Upgrade all Chocolatey packages
choco-upgrade:
    @echo "ğŸ“¦ Upgrading all Chocolatey packagesâ€¦"
    sudo choco upgrade all -y

# * Winget
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Winget

# ğŸ” Show Winget upgrades available
winget-check:
    @echo "ğŸ” Checking for Winget package updatesâ€¦"
    winget upgrade --include-unknown

# ğŸ“¦ Upgrade Winget packages (nonâ€‘interactive)
winget-upgrade:
    @echo "ğŸ“¦ Upgrading Winget packagesâ€¦"
    winget upgrade --all --include-unknown --accept-source-agreements --accept-package-agreements

# * MSYS2
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category MSYS2

# ğŸ” Preview available MSYS2 upgrades
msys2-check:
    @echo "ğŸ” Checking for MSYS2 package updatesâ€¦"
    @/usr/bin/bash.exe -lc 'yes n | pacman -Syu || true'

# â™»ï¸ Upgrade MSYS2 packages (autoâ€‘confirm)
msys2-upgrade:
    @echo "â™»ï¸ Upgrading MSYS2 packagesâ€¦"
    @/usr/bin/bash.exe -lc 'pacman -Syu --noconfirm'

# ğŸ§¹ Cleanup MSYS2 package cache and old versions
msys2-clean:
    @echo "ğŸ§¹ Cleaning MSYS2 cache and stale packagesâ€¦"
    @/usr/bin/bash.exe -lc 'pacman -Sc --noconfirm && paccache -rv'

# * OS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category OS

# ğŸ§­ Check for pending Windows OS updates (requires PSWindowsUpdate)
os-check:
    @echo "ğŸ§­ Checking for pending Windows updates (PowerShell)â€¦"
    @sudo powershell -Command "Get-WindowsUpdate"

# * System (highâ€‘level convenience targets)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category System

# ğŸ” Preview system package updates (no changes applied)
system-check: scoop-check choco-check winget-check msys2-check os-check

# ğŸ› ï¸ Weekly system upgrade (safe, routine updates)
system-upgrade: scoop-upgrade choco-upgrade winget-upgrade

# ğŸ§¹ Clean caches & repair shortcuts
system-clean: scoop-clean msys2-clean scoop-reset

# ğŸ§¹ğŸ› ï¸ Monthly deep maintenance
# Â· performs the weekly upgrade
# Â· upgrades MSYS2 packages
# Â· cleans caches & repairs icons
system-maintain: system-upgrade msys2-upgrade system-clean
