#!/usr/bin/env just
# -*- mode: just -*-

# Justfile for common POSIX system-level maintenance tasks.
# Shared across macOS, Linux, and WSL (for systems using Homebrew).

# * Homebrew
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Homebrew

# ğŸ” Update taps, then preview which formulae and casks are outdated
brew-check:
    @echo "ğŸ”„ Updating Homebrew metadata..."
    brew update
    @echo
    @echo "ğŸ” Checking outdated Homebrew formulae..."
    brew outdated
    @echo
    @echo "ğŸ” Checking outdated Homebrew casks..."
    brew outdated --cask --greedy

# ğŸ“¦ Upgrade installed formulae and casks (no implicit brew update)
brew-upgrade:
    @echo "ğŸ“¦ Upgrading formulae and casks..."
    brew upgrade
    brew upgrade --cask --greedy

# ğŸ§¹ Clean cache and remove orphaned dependencies
brew-clean:
    @echo "ğŸ§¹ Cleaning Homebrew cache and unused dependencies..."
    brew cleanup -s
    brew autoremove

# ğŸ§° Diagnose Homebrew installation
brew-doctor:
    @echo "ğŸ§° Running brew doctor..."
    @sh -c 'brew doctor || echo "âš ï¸  brew doctor returned warnings (exit code $?). Continuing..."'

# ğŸ› ï¸ Monthly deep maintenance (check â†’ upgrade â†’ clean â†’ doctor)
brew-maintain: brew-check brew-upgrade brew-clean brew-doctor

# * Zinit
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Zinit

# ğŸ§ƒ Update zinit core and all plugins
zinit-update:
    @echo "ğŸ§ƒ Updating zinit core and plugins..."
    zsh -ic 'zinit self-update && zinit update --all'

# ğŸ§ƒ Check zinit setup and loaded plugins
zinit-check:
    @echo "ğŸ§ƒ Checking zinit availability and plugin status..."
    zsh -ic 'zinit report || echo "âš ï¸  Zinit not found or not loaded properly."'

# * Completions
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Completions

# ğŸ–¥ï¸ Refresh all completions
completions-upgrade:
    @echo "ğŸ–¥ï¸ Refreshing just completions..."
    just --completions zsh > ~/.config/zsh/completions/_just

    @echo "ğŸ–¥ï¸ Refreshing wezterm completions..."
    wezterm shell-completion --shell zsh > ~/.config/zsh/completions/_wezterm

# * Emacs
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Emacs

# ğŸ“ Update Emacs Elpaca packages in batch mode
emacs-upgrade:
    @echo "ğŸ“ Updating Emacs Elpaca packages..."
    DOTFILES_EMACS_UPDATE=1 emacs --batch --init-directory=~/.emacs.default/ --load=~/.emacs.default/init.el
