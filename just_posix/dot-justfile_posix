#!/usr/bin/env just
# -*- mode: just -*-

# Justfile for common POSIX system-level maintenance tasks.
# Shared across macOS, Linux, and WSL (for systems using Homebrew).

# * Homebrew
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Homebrew

# ğŸ” Preview which formulae and casks are outdated
brew-check: _brew-check-outdated _brew-check-casks

_brew-check-outdated:
    @echo "ğŸ” Checking outdated Homebrew formulae..."
    brew outdated

_brew-check-casks:
    @echo
    @echo "ğŸ” Checking outdated Homebrew casks..."
    brew outdated --cask --greedy

# ğŸ“¦ Fast weekly updates (e.g., every Monday)
brew-upgrade: _brew-update _brew-upgrade

_brew-update:
    @echo "ğŸ“¦ Updating Homebrew..."
    brew update

_brew-upgrade:
    @echo "ğŸ“¦ Upgrading formulae and casks..."
    brew upgrade
    brew upgrade --cask --greedy

# ğŸ§¹ Deeper monthly/occasional maintenance
brew-maintain: _brew-update _brew-upgrade _brew-clean _brew-doctor

_brew-clean:
    @echo "ğŸ§¹ Cleaning up Homebrew cache and unused dependencies..."
    brew cleanup -s
    brew autoremove

_brew-doctor:
    @echo "ğŸ§¹ Running brew doctor..."
    @sh -c 'brew doctor || echo "âš ï¸  brew doctor returned warnings (exit code $?). Continuing..."'

# * Zinit
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Zinit

# ğŸ§ƒ Update zinit core and all plugins
zinit-update:
    @echo "ğŸ§ƒ Running zinit self-update and plugin updates..."
    zsh -ic 'zinit self-update && zinit update --all'

# ğŸ§ƒ Check zinit setup and loaded plugins
zinit-check:
    @echo "ğŸ§ƒ Checking zinit availability and plugin status..."
    zsh -ic 'zinit report || echo "âš ï¸  Zinit not found or not loaded properly."'

# * Completions
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Completions

# ğŸ–¥ï¸ Refresh just completions for zsh
completions-just:
    @echo "ğŸ–¥ï¸ Refreshing just completions..."
    just --completions zsh > ~/.config/zsh/completions/_just

# ğŸ–¥ï¸ Refresh wezterm completions for zsh
completions-wezterm:
    @echo "ğŸ–¥ï¸ Refreshing wezterm completions..."
    wezterm shell-completion --shell zsh > ~/.config/zsh/completions/_wezterm

# ğŸ–¥ï¸ Refresh all completions
completions-update: completions-just completions-wezterm

# * Emacs
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# @category Emacs

# ğŸ“ Update Emacs Elpaca packages in batch mode
emacs-update:
    @echo "ğŸ“ Updating Emacs Elpaca packages..."
    DOTFILES_EMACS_UPDATE=1 emacs --batch --init-directory=~/.emacs.default/ --load=~/.emacs.default/init.el
