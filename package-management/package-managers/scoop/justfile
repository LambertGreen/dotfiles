#!/usr/bin/env just --justfile
# Scoop Package Manager Commands (Windows)
# Documentation and execution for scoop operations
# Scoop is the Windows package manager that's clean and reliable

set shell := ["bash", "-uc"]

# Default: show available commands
default:
    @echo "ğŸª£ Scoop Package Manager (Windows)"
    @echo ""
    @echo "ğŸ“¦ Basic Operations:"
    @echo "  just install           # Install packages from current machine class"
    @echo "  just check             # Check for outdated packages"
    @echo "  just upgrade           # Upgrade all packages"
    @echo "  just clean             # Clean up caches and old versions"
    @echo ""
    @echo "ğŸ“‹ Information:"
    @echo "  just list              # List installed packages"
    @echo "  just search <package>  # Search for packages"
    @echo "  just info <package>    # Get package information"
    @echo ""
    @echo "ğŸ”§ Advanced:"
    @echo "  just export            # Export current packages to scoopfile.json"
    @echo "  just doctor            # Run scoop checkup"
    @echo "  just buckets           # List available buckets"
    @echo "  just add-bucket <name> # Add a bucket"
    @echo ""
    @echo "ğŸ’¡ Scoop Tips:"
    @echo "  - Installs to ~/scoop by default (no admin needed)"
    @echo "  - Use 'extras' bucket for GUI apps"
    @echo "  - Use 'main' bucket for CLI tools"
    @echo "  - Run from WSL or MSYS2 bash shell"

# Install packages from current machine class
install:
    @if [[ -f ~/.dotfiles.env ]]; then \
        source ~/.dotfiles.env; \
        scoopfile="$(pwd)/../../machines/$DOTFILES_MACHINE_CLASS/scoop/scoopfile.json"; \
        if [[ -f "$scoopfile" ]]; then \
            echo "ğŸª£ Installing packages from: $scoopfile"; \
            scoop import "$scoopfile"; \
        else \
            echo "âŒ No scoopfile.json found for machine class: $DOTFILES_MACHINE_CLASS"; \
        fi; \
    else \
        echo "âŒ Configuration not found. Run: just configure"; \
    fi

# Check for outdated packages
check:
    @echo "ğŸ” Checking for outdated packages..."
    @scoop status

# Upgrade all packages
upgrade:
    @echo "ğŸ”„ Upgrading all packages..."
    @scoop update '*'
    @echo "âœ… Upgrade complete"

# Clean up caches and old versions
clean:
    @echo "ğŸ§¹ Cleaning scoop..."
    @scoop cleanup '*'
    @scoop cache rm '*'
    @echo "âœ… Cleanup complete"

# List installed packages
list:
    @echo "ğŸª£ Installed packages:"
    @scoop list

# Search for packages
search package:
    @echo "ğŸ” Searching for: {{package}}"
    @scoop search {{package}}

# Get package information
info package:
    @echo "â„¹ï¸  Information for: {{package}}"
    @scoop info {{package}}

# Export current packages
export:
    @echo "ğŸ“¦ Exporting current packages..."
    @scoop export > scoopfile.json
    @echo "âœ… Exported to ./scoopfile.json"
    @echo ""
    @echo "ğŸ’¡ To use this export:"
    @echo "  scoop import scoopfile.json"

# Run scoop checkup
doctor:
    @echo "ğŸ¥ Running scoop checkup..."
    @scoop checkup

# List available buckets
buckets:
    @echo "ğŸª£ Available buckets:"
    @scoop bucket known

# Add a bucket
add-bucket name:
    @echo "â• Adding bucket: {{name}}"
    @scoop bucket add {{name}}

# Common package operations
install-package package:
    @echo "ğŸª£ Installing: {{package}}"
    @scoop install {{package}}

remove-package package:
    @echo "ğŸ—‘ï¸  Removing: {{package}}"
    @scoop uninstall {{package}}

# Update scoop itself
update-scoop:
    @echo "ğŸ”„ Updating scoop..."
    @scoop update

# Install from extras bucket
install-from-extras package:
    @echo "ğŸ“± Installing from extras bucket: {{package}}"
    @scoop install extras/{{package}}

# Show app manifests (useful for troubleshooting)
show-manifest package:
    @echo "ğŸ“„ Manifest for: {{package}}"
    @scoop cat {{package}}

# List current buckets
list-buckets:
    @echo "ğŸª£ Current buckets:"
    @scoop bucket list